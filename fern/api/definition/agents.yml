# yaml-language-server: $schema=https://raw.githubusercontent.com/fern-api/fern/main/fern.schema.json

imports:
  commons: commons.yml
  events: events.yml

service:
  auth: true
  base-path: /environments/{environmentId}
  path-parameters:
    environmentId: commons.EnvironmentId
  endpoints:
    list:
      path: /agents
      method: GET
      display-name: List agents
      response: ListAgentsResponse

    create:
      path: /agents
      method: POST
      display-name: Create an agent
      request: Agent
      response: AgentResponse
      errors: 
        - commons.BadRequestError

    get:
      path: /agents/{agentId}
      method: GET
      display-name: Get an agent
      path-parameters:
        agentId: commons.AgentId
      response: AgentResponse
      errors: 
        - commons.BadRequestError
        - commons.NotFoundError

    getAgentLogs:
      path: /agents/{agentId}/logs
      method: GET
      display-name: Get logs for an agent
      path-parameters:
        agentId: commons.AgentId
      response: GetAgentLogsResponse
      errors: 
        - commons.BadRequestError
        - commons.NotFoundError
      examples:
        - name: Example0 
          path-parameters:
            agentId: $commons.AgentId
          response: 
            body: $GetAgentLogsResponse.Example0

types:
  ListAgentsResponse:
    properties:
      data: optional<list<Agent>>
  
  AgentResponse:
    properties:
      data: optional<Agent>

  Agent:
    docs: Properties used to create a new agent
    properties:
      topics:
        docs: The topics the agent should listen for
        type: optional<list<events.EventTopic>>
      compiler:
        docs: The compiler of the agent
        type: optional<Compiler>
      source:
        docs: The source of the agent
        type: optional<string>
    examples: 
      - name: Example0 
        value: 
          topics: 
            - $events.EventTopic.Example0
          compiler: $Compiler.Example0
          source: $Source.Example0
  
  Compiler:
    docs: The compiler of the agent
    enum:
      - js
    examples: 
      - name: Example0 
        value: js
  
  GetAgentLogsResponse:
    properties:
      pagination: optional<commons.Pagination>
      data: optional<list<AgentLog>>
    examples:
      - name: Example0 
        value: 
          pagination: $commons.Pagination.Example0
          data: $AgentLog.Example0

  AgentLog:
    docs: A log of an agent execution
    properties:
      eventId: commons.EventId
      success:
        docs: Whether the agent execution was successful
        type: boolean
      createdAt: string
      log:
        docs: The log of the agent execution
        type: optional<string>
    examples: 
      - name: Example0 
        value: 
          eventId: us_evt_9cuesESa7W9cuesE
          success: true
          createdAt: '2022-09-18T00:19:57.007Z'
          log: SUCCESS       